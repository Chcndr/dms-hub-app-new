# ============================================
# E-FIL Plug&Pay PagoPA Configuration
# Comune di Grosseto - Mercati
# ============================================

# === Endpoint E-FIL Plug&Pay ===
# TEST: Usa endpoint di test per sviluppo
# PROD: Sostituisci con endpoint di produzione forniti da E-FIL

EFIL_BASE_URL=https://test.plugnpay.efil.it/plugnpay

# WSDL dei servizi (derivati da BASE_URL se non specificati)
EFIL_WSPAYMENT_WSDL=${EFIL_BASE_URL}/WSPayment?wsdl
EFIL_WSFEED_WSDL=${EFIL_BASE_URL}/WSFeed?wsdl
EFIL_WSDELIVER_WSDL=${EFIL_BASE_URL}/WSDeliver?wsdl
EFIL_WSGENERATORPDF_WSDL=${EFIL_BASE_URL}/WSGeneratorPdf?wsdl
EFIL_WSPAYMENTNOTIFY_WSDL=${EFIL_BASE_URL}/WSPaymentNotify?wsdl

# === Credenziali E-FIL ===
# Fornite da E-FIL durante l'onboarding
EFIL_USERNAME=<user>
EFIL_PASSWORD=<pass>
EFIL_APPLICATION_CODE=<fornito da E-FIL>
EFIL_ID_GESTIONALE=DMS-GROSSETO

# Solo per pluri-intermediazione (opzionale)
# EFIL_CODICE_SEGREGAZIONE=<se pluri-intermediato>

# === Callback URLs ===
# URL dove PagoPA reindirizza dopo il pagamento
DMS_PAGOPA_RETURN_URL=https://miohub.app/payments/return
DMS_PAGOPA_CALLBACK_URL=https://miohub.app/api/wallet/callback

# === Backoffice ===
DMS_BACKOFFICE_BASEURL=https://miohub.app

# === sFTP Rendicontazione (opzionale) ===
# Per download automatico file N001 rendicontazione
# EFIL_SFTP_HOST=<sftp-host>
# EFIL_SFTP_USER=<sftp-user>
# EFIL_SFTP_PRIVATE_KEY_PATH=./.keys/efil_sftp
# EFIL_SFTP_BASEDIR=/rendicontazione

# === Logging ===
LOG_LEVEL=info

# ============================================
# NOTE IMPORTANTI
# ============================================
# 
# 1. Per ottenere le credenziali E-FIL:
#    - Contattare E-FIL tramite il Comune di Grosseto
#    - Richiedere accesso ambiente TEST per sviluppo
#    - Richiedere accesso ambiente PROD per go-live
#
# 2. Flusso di integrazione:
#    a) WSFeed: Crea posizione debitoria (avviso PagoPA)
#    b) WSPayment: Avvia pagamento spontaneo con redirect checkout
#    c) WSDeliver: Verifica stato pagamento
#    d) WSGeneratorPdf: Genera PDF avviso/quietanza
#    e) WSPaymentNotify: Notifica pagamenti "Fuori Nodo"
#
# 3. Callback:
#    - Return URL: Dove l'utente viene reindirizzato dopo pagamento
#    - Callback URL: Notifica server-to-server (pi√π affidabile)
#
# 4. Riconciliazione:
#    - Job cron ogni 30 minuti per RicercaPagamentiGiornalieri
#    - Download file N001 via sFTP per riconciliazione contabile
#
